# xlsxファイルからDMLファイルを作成するPythonスクリプト

1つのxlsxファイル内でDBテーブルごとにシートを設けることで、対象シート（テーブル）のすべてのINSERT文のファイルを出力するPythonスクリプトです。

## 使い方

### 1. 環境構築

ライブラリの管理に [Pipenv](https://pipenv.pypa.io/en/latest/) を使っています。  
以下のコマンドでライブラリをインストールします。

```sh
pipenv sync
```

### 2. 各種ファイルの準備

1. 設定ファイル（`*.json`）を準備します。（`app_config-sample.json` をコピーして使ってください。）
   - 設定ファイルのパスを指定しない場合
     - プロジェクト フォルダーの直下に `app_config.json` を配置します。
   - 設定ファイルのパスを指定する場合
     - 任意の場所へjsonファイルを任意の名前で配置します。</br></br>

2. DMLファイルの作成元となるxlsxファイルを任意のパスへ作成します。（テンプレートは `sample` フォルダー内の `dbeaver_sample_db_*_data.xlsx` をコピーして使ってください。）</br></br>

3. 必要に応じて設定ファイルの内容を以下のように変更します。

#### 2.1. 設定ファイルの変更

##### 2.1.1. xlsxファイルの行番号やセル位置と合わせる必要があるプロパティ

| プロパティ名                                    | 説明                             |
|-------------------------------------------|--------------------------------|
| table_name_cell.row, table_name_cell.cell | テーブル名のセル位置                     |
| column_name_row                           | カラム名の行番号                       |
| data_type_row                             | データ型の行番号                       |
| key_position_row                          | 主キーのカラム順序の行番号（2025-09-11現在未使用） |
| no_quotation_row                          | 引用符を付加しないカラムを指定する行番号           |
| data_start_cell.row, data_start_cell.cell | データ開始のセル位置                     |

##### 2.1.2. DMLファイルの出力に影響のあるプロパティ

| プロパティ名                   | 説明                                                                                                                                      |
|--------------------------|-----------------------------------------------------------------------------------------------------------------------------------------|
| target_sheet_names       | 対象のシート名をカンマ区切りで指定します。<br/>DMLファイルを作成したいシートの方が少ない場合に使います。<br/>未指定（""）の場合は全シートが対象になります。<br/>exclude_sheet_namesに同じシート名が含まれている場合はエラーになります。 |
| exclude_sheet_names      | DMLファイルの作成を除外したいシート名をカンマ区切りで指定します。<br/>target_sheet_namesに同じシート名が含まれている場合はエラーになります。                                                     |
| number_of_lines_per_file | DMLファイル内の行数を指定します。<br/>-1の場合はシート内全件のステートメントが1ファイル内に出力されます。<br/>大量レコードのDMLを実行する時に、行数を分割してDMLファイルを出力したい場合に使います。                           |

### 3. コマンドの実行

#### 3.1. 設定ファイルのパスを指定しない場合

```sh
python -m create_dml -s "<DML作成元xlsxファイルのパス>" -d "<DMLファイル作成先フォルダのパス>"
```

#### 3.2. 設定ファイルのパスを指定する場合

```sh
python -m create_dml -s "<DML作成元xlsxファイルのパス>" -d "<DMLファイル作成先フォルダのパス>" -c "設定ファイルのパス"
```

#### 3.3. 補足

`-d` オプションを指定しない場合、一時フォルダ（`tempfile.gettempdir()` のOS依存結果）に実行日時のフォルダ（`yyyyMMdd-HHmmss`）が作成され、その配下にDMLファイルが出力されます。
